<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Admin Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 1rem;
      background: #f4f4f4;
    }
    h1 {
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      padding: 0.75rem;
      border: 1px solid #ccc;
      text-align: left;
    }
    th {
      background: #ddd;
    }
    tr:nth-child(even) {
      background: #fafafa;
    }
    .status-active {
      color: green;
      font-weight: bold;
    }
    .status-inactive {
      color: gray;
    }
  </style>
</head>
<body>

  <h1>Live-Admin-Panel</h1>
  <p>Letztes Update: <span id="lastUpdate">—</span></p>

  <table>
    <thead>
      <tr>
        <th>Spieler-ID</th>
        <th>Aktuelle Frage</th>
        <th>Punkte</th>
        <th>Status</th>
        <th>Zuletzt</th>
      </tr>
    </thead>
    <tbody id="playerTableBody">
      <tr><td colspan="5" style="text-align:center">Lade Daten…</td></tr>
    </tbody>
  </table>

  <script>
    // Funktion, um die Tabelle zu aktualisieren
    async function fetchPlayerStates() {
      try {
        const res = await fetch('/api/player-states');
        if (!res.ok) throw new Error('Server-Antwort ' + res.status);
        const states = await res.json();
        const tbody = document.getElementById('playerTableBody');
        tbody.innerHTML = ''; // alte Zeilen löschen

        states.forEach(player => {
          const tr = document.createElement('tr');

          // Spieler-ID
          const tdId = document.createElement('td');
          tdId.textContent = player.userId;
          tr.appendChild(tdId);

          // Frage-Index
          const tdQ = document.createElement('td');
          tdQ.textContent = player.currentQuestionIndex + 1; // +1, weil Index 0-basiert
          tr.appendChild(tdQ);

          // Punkte
          const tdScore = document.createElement('td');
          tdScore.textContent = player.score;
          tr.appendChild(tdScore);

          // Status
          const tdStatus = document.createElement('td');
          tdStatus.textContent = player.status;
          tdStatus.className = player.status === 'aktiv'
                              ? 'status-active'
                              : 'status-inactive';
          tr.appendChild(tdStatus);

          // letztes Update
          const tdLast = document.createElement('td');
          const date = new Date(player.lastUpdate);
          tdLast.textContent = date.toLocaleTimeString();
          tr.appendChild(tdLast);

          tbody.appendChild(tr);
        });

        // Datum des Abrufs anzeigen
        document.getElementById('lastUpdate').textContent =
          new Date().toLocaleTimeString();
      } catch (err) {
        console.error('Fehler beim Laden der Player-States:', err);
      }
    }

    // alle 5 Sekunden aktualisieren
    fetchPlayerStates();
    setInterval(fetchPlayerStates, 5000);
  </script>

</body>
</html>
